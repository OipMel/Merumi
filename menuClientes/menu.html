<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Merumi | Turnero de Mesas</title>

  <style>
    /* üîπ Reset y fuentes */
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Poppins", sans-serif; }

    body{
      background-image: url('../imagenes/mesa3.jpg');
      background-size: cover;
      background-position: center;
      color: #f5f5f5;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding-bottom: 80px;
    }

    h1{ margin-top: 70px; margin-bottom: 20px; }

    /* Cabecera y navegaci√≥n */
    .header{
      width: 100%;
      height: clamp(120px, 30vh, 320px);
      background-color: #011930;
      overflow: hidden;
      position: relative; /* FIX: necesario para posicionar el bot√≥n dentro del header */
    }

    .header img.logo-header{ width: 100%; height: 100%; object-fit: contain; display:block; }

    nav{ width:100%; background:#001a33; margin-top: 0; }
    nav ul{ list-style:none; display:flex; gap:30px; padding:12px 20px; justify-content:center; }
    nav ul li a{ color:white; text-decoration:none; font-weight: bold; padding:6px 12px; border-radius:5px; }
    nav ul li a:hover{ background:#0b1f3f; text-decoration: wavy underline; }

    /* Bot√≥n cerrar sesi√≥n (arriba derecha dentro del header) */
    #btnCerrarSesion{
      position: absolute;
      top: 20px;
      right: 25px;
      background-color: #e74c3c;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color .2s, transform .1s;
      z-index: 100;
    }
    #btnCerrarSesion:hover{ background-color:#c0392b; transform: scale(1.05); }

    /* Secciones generales */
    .seccion{ margin-bottom: 40px; width: 100%; max-width: 500px; text-align: center; }

    /* Plano de mesas */
    .plano{
      display: grid;
      grid-template-columns: repeat(4, 100px);
      gap: 20px;
      margin-bottom: 30px;
      background-color: rgba(16,47,71,0.95);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
    }

    .mesa{
      background-color: #1f4e6d;
      border-radius: 10px;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      transition: transform .2s;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .mesa:hover{ transform: scale(1.05); }
    .disponible{ background-color: #1e7d32; }
    .reservado { background-color: #b85c00; }

    .mesa img{
      width:50px; height:50px; object-fit:contain; margin-bottom:5px;
      filter: drop-shadow(0 0 3px rgba(0,0,0,0.4));
    }

    /* Panel informaci√≥n mesa */
    #infoMesa{
      background-color: rgba(31,78,109,0.95);
      border-radius: 10px;
      padding: 20px;
      width: 280px;
      text-align: center;
      display: none;
      margin-top: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      transition: all .3s ease-in-out;
    }
    #infoMesa h2{ margin-bottom:15px; font-weight:500; }
    #infoMesa p{ margin:6px 0; font-weight:300; }

    /* Botones globales */
    .btn-primary{
      margin-top: 15px;
      background-color: #00b894;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color .2s;
    }
    .btn-primary:hover{ background-color:#009e7d; }

    /* Mis reservas */
    .reserva{
      background-color: rgba(16,47,71,0.95);
      padding:15px; border-radius:10px; width:220px; text-align:left;
      box-shadow:0 0 10px rgba(0,0,0,0.4);
    }
    .reserva p{ margin:5px 0; font-weight:300; }
    .reserva button{
      margin-top:10px; background-color:#e74c3c; color:white; border:none; padding:8px 12px;
      border-radius:6px; cursor:pointer; font-weight:bold; transition:background-color .2s;
    }
    .reserva button:hover{ background-color:#c0392b; }

    /* Footer */
    footer{
      position: fixed; left:50%; transform:translateX(-50%); bottom:12px; color:#8ca2c0;
      font-size:.9rem; z-index:10;
    }

    /* Responsive peque√±o */
    @media (max-width: 600px){
      .plano{ grid-template-columns: repeat(2, 100px); }
      .seccion { max-width: 95%; }
    }
  </style>
</head>
<body>

  <!-- Cabecera -->
  <header class="header">
    <img src="../imagenes/banner1.0.png" class="logo-header" alt="Banner Merumi" />
    <button id="btnCerrarSesion">Cerrar sesi√≥n</button>
  </header>

  <!-- Navegaci√≥n -->
  <nav>
    <ul>
      <li><a href="#mesas">Ver mesas</a></li>
      <li><a href="#misReservas">Mis reservas</a></li>
    </ul>
  </nav>

  <h1>Mapa de Mesas</h1>

  <!-- Mesas internas -->
  <div class="seccion" id="mesas">
    <h3>Sal√≥n Interno</h3>
    <div class="plano" id="planoInterno"></div>
  </div>

  <!-- Mesas externas -->
  <div class="seccion">
    <h3>Terraza / Externas</h3>
    <div class="plano" id="planoExterno"></div>
  </div>

  <!-- Panel informaci√≥n -->
  <div id="infoMesa">
    <h2>Informaci√≥n de la Mesa</h2>
    <p id="numeroMesa"></p>
    <p id="estadoMesa"></p>
    <p id="capacidad"></p>
    <button id="btnReservar" class="btn-primary">Reservar</button>
  </div>

  <!-- Mis reservas -->
  <div class="seccion" id="misReservas">
    <h3>Mis Reservas</h3>
    <div id="listaReservas" style="display:flex; flex-wrap:wrap; gap:15px; justify-content:center; margin-top:15px;"></div>
  </div>

  <footer>¬© 2025 - Merumi | Sistema de reservas</footer>

  <!-- Script principal -->
  <script>
    const imagenMesa = "../imagenes/mesalogo.png";

    const mesasInternas = [
      { numero: 1, estado: 'disponible' },
      { numero: 2, estado: 'reservado' },
      { numero: 3, estado: 'disponible' },
      { numero: 4, estado: 'reservado' },
      { numero: 5, estado: 'disponible' },
      { numero: 6, estado: 'reservado' },
      { numero: 7, estado: 'disponible' },
      { numero: 8, estado: 'disponible' },
    ];

    const mesasExternas = [
      { numero: 9, estado: 'disponible' },
      { numero: 10, estado: 'reservado' },
      { numero: 11, estado: 'disponible' },
      { numero: 12, estado: 'reservado' },
    ];

    // Referencias DOM
    const planoInterno = document.getElementById('planoInterno');
    const planoExterno = document.getElementById('planoExterno');
    const info = document.getElementById('infoMesa');
    const numeroMesa = document.getElementById('numeroMesa');
    const estadoMesa = document.getElementById('estadoMesa');
    const capacidadElem = document.getElementById('capacidad');
    const btnReservar = document.getElementById('btnReservar');
    const listaReservas = document.getElementById('listaReservas');
    const btnCerrarSesion = document.getElementById('btnCerrarSesion');

    let reservas = [];

    // Asigna capacidad aleatoria (2..5) a cada mesa
    function asignarCapacidad(mesas){
      mesas.forEach(m => m.capacidad = Math.floor(Math.random()*4) + 2);
    }

    function renderizarMesas(lista, contenedor){
      contenedor.innerHTML = '';
      lista.forEach(mesa => {
        const div = document.createElement('div');
        div.className = 'mesa ' + mesa.estado;
        div.innerHTML = '<img src="'+imagenMesa+'" alt="Mesa '+mesa.numero+'"><span>'+mesa.numero+'</span>';
        div.onclick = () => mostrarInfo(mesa, lista, contenedor);
        contenedor.appendChild(div);
      });
    }

    function mostrarInfo(mesa, lista, contenedor){
      info.style.display = 'block';
      numeroMesa.textContent = 'N√∫mero de mesa: ' + mesa.numero;
      estadoMesa.textContent = 'Estado: ' + mesa.estado;
      capacidadElem.textContent = 'Capacidad: ' + (mesa.capacidad || '‚Äî') + ' persona(s)';
      // asigna handler del bot√≥n (lo reemplaza cada vez)
      btnReservar.onclick = () => reservarMesa(mesa, lista, contenedor);
    }

    function reservarMesa(mesa, lista, contenedor){
      if(mesa.estado === 'disponible'){
        mesa.estado = 'reservado';
        const fecha = new Date().toLocaleDateString();
        const turno = '20:00';
        reservas.push({ numeroMesa: mesa.numero, fecha, turno, estado: 'Confirmada' });
        alert('¬°Mesa ' + mesa.numero + ' reservada con √©xito!');
        renderizarMesas(lista, contenedor);
        mostrarInfo(mesa, lista, contenedor);
        renderizarReservas();
      } else {
        alert('No se puede reservar la mesa ' + mesa.numero + ' (' + mesa.estado + ')');
      }
    }

    function renderizarReservas(){
      listaReservas.innerHTML = '';
      if(reservas.length === 0){
        listaReservas.innerHTML = '<p>No hay reservas.</p>';
        return;
      }

      reservas.forEach((reserva, index) => {
        const div = document.createElement('div');
        div.className = 'reserva';
        div.innerHTML = ''
          + '<p><strong>Mesa:</strong> ' + reserva.numeroMesa + '</p>'
          + '<p><strong>Fecha:</strong> ' + reserva.fecha + '</p>'
          + '<p><strong>Turno:</strong> ' + reserva.turno + '</p>'
          + '<p><strong>Estado:</strong> ' + reserva.estado + '</p>'
          + '<button>Cancelar</button>';
        const btnCancelar = div.querySelector('button');
        btnCancelar.onclick = () => {
          if(confirm('¬øCancelar reserva de la mesa ' + reserva.numeroMesa + '?')){
            reservas.splice(index, 1);
            renderizarReservas();
          }
        };
        listaReservas.appendChild(div);
      });
    }

    // Inicializaci√≥n
    asignarCapacidad(mesasInternas);
    asignarCapacidad(mesasExternas);
    renderizarMesas(mesasInternas, planoInterno);
    renderizarMesas(mesasExternas, planoExterno);
    renderizarReservas();

    // Cerrar sesi√≥n
    btnCerrarSesion.onclick = () => {
      window.location.href = 'menu_sesion.html'; // ajustar ruta real
    };
  </script>
</body>
</html>
